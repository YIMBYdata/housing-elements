(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{2562:function(e,t,n){"use strict";n.r(t),n.d(t,{useFetch:function(){return y},useBufferSelector:function(){return v},default:function(){return w}});var s=n(5893),r=n(6265),i=n(7294),a=n(4555),l=n(862),o=n(9008),c=n(7905),u=(n(801),n(8767));function d(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var s=0,r=function(){};return{s:r,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw i}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e){return(0,u.useQuery)(e,(function(){return fetch(e).then((function(e){return e.json()}))}),{staleTime:1/0})}var f=(0,c.ZP)({accessToken:"pk.eyJ1Ijoic2lkLWthcCIsImEiOiJjamRpNzU2ZTMxNWE0MzJtZjAxbnphMW5mIn0.b6m4jgFhPOPOYOoaNGmogQ"}),x=[[-123.1360271,36.97640742],[-121.53590925,38.82979915]];function v(){var e=(0,i.useState)(25),t=e[0],n=e[1],r=[0,5,10,25,50,75,100].map((function(e){return(0,s.jsxs)("span",{children:[(0,s.jsx)("input",{id:"buffer-"+e,type:"radio",checked:t==e,value:"conservative",onChange:function(){return n(e)}}),(0,s.jsxs)("label",{htmlFor:"buffer-"+e,className:"ml-1 mr-3 text-sm",children:[e," feet"]})]},e)}));return{buffer:t,bufferInput:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Geocoding buffer size:"}),(0,s.jsx)("div",{className:"max-w-xs",children:r})]})}}var j={keys:["name"],threshold:.1,distance:5};function g(e,t,n,r){return(0,s.jsx)("button",p(p({className:r},e),{},{children:t.name}))}var b={"line-color":"black","line-width":.5},N=[{name:"All sites",value:"overall"},{name:"Nonvacant sites",value:"nonvacant"},{name:"Vacant sites",value:"vacant"}],_=[{name:"APN only",value:"apn_only"},{name:"APN and geocoding",value:"apn_and_geo"}];function w(){var e=(0,i.useState)("Overview"),t=e[0],n=e[1],r="Overview"==t,l=(0,i.useState)(null),u=l[0],m=l[1],h=r?null:"/data/"+t+"/sites_with_matches.geojson",w=r?null:"/data/"+t+"/permits.geojson",O=y("/data/summary.json").data,P=(0,i.useMemo)((function(){return function(e){var t=(e||[]).slice();t.sort((function(e,t){return e.city.localeCompare(t.city)}));for(var n={},s=[{name:"Overview",value:"Overview"}],r=0;r<t.length;r++){var i=t[r];s.push(p(p({},i),{},{value:i.city,name:i.city})),n[i.city]=r+1}return[s,n]}(O)}),[O]),M=P[0],C=P[1],L=(0,i.useMemo)((function(){return M[C[t]]}),[O,t]),I=null,W=(0,i.useState)("overall"),F=W[0],E=W[1],T=(0,i.useState)("apn_and_geo"),J=T[0],Z=T[1],U=v(),D=U.buffer,H=U.bufferInput,G="apn_only"==J?"results_apn_only":"results_apn_and_geo_".concat(D,"ft"),Q="geo_matched_".concat(D,"ft"),z={"fill-color":["case",["all",["get","apn_matched"],["get",Q]],"green",["get","apn_matched"],"yellow",["get",Q],"blue","red"],"fill-opacity":.3},B=["get","P(dev)",["get",F,["get",G]]],R={"fill-color":["interpolate",["linear"],B,-.1,"white",.5,"blue",1,"blue"],"fill-opacity":r?.5:0};return I=(0,s.jsxs)("div",{className:"mx-auto mb-10 align-center items-center justify-center flex flex-col",children:[(0,s.jsxs)("div",{className:"lg:grid lg:grid-cols-3 flex flex-col",children:[(0,s.jsx)("div",{className:"m-4 col-span-1",children:(0,s.jsx)(a.ZP,{search:!0,onChange:n,options:M,fuseOptions:j,value:t,renderOption:g})}),(0,s.jsx)("div",{className:"col-span-1",children:(0,s.jsx)("h1",{className:"mt-4 text-center text-4xl",children:t})}),(0,s.jsx)("div",{className:"col-span-1 m-4",children:!r&&H})]}),(0,s.jsx)("div",{className:"w-full justify-center flex flex-row",children:(0,s.jsxs)(f,{style:"mapbox://styles/mapbox/streets-v9",containerStyle:{height:"700px",width:"1000px"},fitBounds:(null===L||void 0===L?void 0:L.bounds)||x,onMouseMove:function(e,t){var n=e.queryRenderedFeatures(t.point).filter((function(e){return"sitesWithMatches"==e.source||"permits"==e.source})).length>0;e.getCanvas().style.cursor=n?"pointer":"default"},onClick:function(e,t){var n=e.queryRenderedFeatures(t.point,{layers:["sitesWithMatchesLayer","permitsLayer","summaryLayer"]});n.length>0?m({layer:n[0].layer.id,element:n[0],location:t.lngLat.toArray()}):m(null)},children:[(0,s.jsx)(c.X$.Consumer,{children:function(e){var t,n=d(e.getStyle().layers);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.id.includes("place-")&&e.setLayoutProperty(i.id,"visibility",r?"none":"visible")}}catch(a){n.e(a)}finally{n.f()}return(0,s.jsx)(s.Fragment,{})}}),(0,s.jsx)(c.Hw,{id:"permits",geoJsonSource:{data:w,type:"geojson"}}),(0,s.jsx)(c.Hw,{id:"sitesWithMatches",geoJsonSource:{data:h,type:"geojson"}}),(0,s.jsx)(c.Hw,{id:"summary",geoJsonSource:{data:"/data/summary.geojson",type:"geojson"}}),(0,s.jsx)(c.Hw,{id:"summaryCentroids",geoJsonSource:{data:"/data/summary_centroids.geojson",type:"geojson"}}),(0,s.jsx)(c.mh,{id:"sitesWithMatchesLayer",type:"fill",sourceId:"sitesWithMatches",paint:z,layout:{visibility:r?"none":"visible"}}),(0,s.jsx)(c.mh,{id:"sitesWithMatchesOutlineLayer",type:"line",sourceId:"sitesWithMatches",paint:b,minZoom:15,layout:{visibility:r?"none":"visible"}}),(0,s.jsx)(c.mh,{id:"sitesWithMatchesTextLayer",type:"symbol",sourceId:"sitesWithMatches",layout:{"text-field":"{site_capacity_units}",visibility:r?"none":"visible"},paint:{"text-color":"hsl(0, 0, 35%)"},minZoom:17}),(0,s.jsx)(c.mh,{id:"permitsLayer",type:"circle",sourceId:"permits",paint:{"circle-color":["case",["==",["get","permit_category"],"ADU"],"hsl(169, 76%, 50%)",["==",["get","permit_category"],"SU"],"hsl(169, 76%, 50%)","green"],"circle-radius":{base:1.75,stops:[[12,1.5],[15,4],[22,180]]}},layout:{visibility:r?"none":"visible"}}),(0,s.jsx)(c.mh,{id:"summaryLayer",type:"fill",sourceId:"summary",paint:R,layout:{visibility:r?"visible":"none"}}),(0,s.jsx)(c.mh,{id:"summaryTextLayer",type:"symbol",sourceId:"summaryCentroids",layout:{"text-field":["concat",["get","city"],"\n",["number-format",B,{"max-fraction-digits":3}]],visibility:r?"visible":"none"},paint:{"text-color":"hsl(0, 0, 35%)"}}),u&&(0,s.jsx)(c.GI,{coordinates:u.location,children:A(D,u.layer,u.element.properties)},u.element.id),r?(0,s.jsx)(s.Fragment,{}):k]})}),L&&S(L,D),r&&(0,s.jsxs)("div",{className:"lg:grid lg:grid-cols-3 flex flex-col",children:[(0,s.jsx)("div",{className:"m-4 col-span-1",children:(0,s.jsx)(a.ZP,{search:!0,onChange:E,options:N,fuseOptions:j,value:F,renderOption:g})}),(0,s.jsx)("div",{className:"m-4 col-span-1",children:(0,s.jsx)(a.ZP,{search:!0,onChange:Z,options:_,fuseOptions:j,value:J,renderOption:g})}),(0,s.jsx)("div",{className:"m-4 col-span-1",children:H})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(o.default,{children:[(0,s.jsx)("title",{children:'What Gets Built on Sites that Cities "Make Available" for Housing?'}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"})]}),I]})}var O="mx-1 w-3 h-3 inline-block border border-black border-opacity-100",P="mx-1 w-3 h-3 inline-block rounded-full",k=(0,s.jsxs)("div",{className:"p-2 absolute right-6 bottom-10 border bg-opacity-80 bg-white",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:O,style:{backgroundColor:"red",opacity:.3}}),"Unmatched site"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:O,style:{backgroundColor:"green",opacity:.3}}),"Matched site (APN and address)"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:O,style:{backgroundColor:"blue",opacity:.3}}),"Matched site (Address only)"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:O,style:{backgroundColor:"yellow",opacity:.3}}),"Matched site (APN only)"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:P,style:{backgroundColor:"green"}}),"Permit (single-family or multifamily)"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:P,style:{backgroundColor:"hsl(169, 76%, 50%)"}}),"Permit (ADU)"]})]});function M(e){return["overall","nonvacant","vacant"].map((function(t){var n,r=null==e[t]["P(dev)"]?(0,s.jsx)(s.Fragment,{children:"N/A"}):(0,s.jsxs)(s.Fragment,{children:[null===(n=e[t]["P(dev)"])||void 0===n?void 0:n.toFixed(3),"\xa0",(0,s.jsxs)("span",{className:"text-gray-400",children:["(",e[t]["# matches"].replaceAll(" ",""),")"]})]});return(0,s.jsx)("td",{className:"text-center",children:r})}))}function S(e,t){var n=e.results_apn_only,r=e["results_apn_and_geo_".concat(t,"ft")];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("table",{className:"table-auto match-table mt-4",children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{children:(0,s.jsxs)("th",{className:"text-center",colSpan:4,children:["Likelihood of development for inventory sites in ",e.city,(0,s.jsx)("span",{className:"text-gray-500",children:"*"})]})})}),(0,s.jsxs)("tbody",{children:[(0,s.jsxs)("tr",{className:"bg-blue-300",children:[(0,s.jsx)("th",{children:"Matching logic"}),(0,s.jsx)("th",{className:"text-center",children:"Overall"}),(0,s.jsx)("th",{className:"text-center",children:"Nonvacant sites"}),(0,s.jsx)("th",{className:"text-center",children:"Vacant sites"})]}),(0,s.jsxs)("tr",{className:"bg-blue-100",children:[(0,s.jsx)("th",{className:"text-left",children:"APN"}),M(n)]}),(0,s.jsxs)("tr",{className:"bg-blue-100",children:[(0,s.jsx)("th",{className:"text-left",children:"APN or address"}),M(r)]})]})]}),(0,s.jsx)("div",{className:"mt-4 text-sm text-gray-500 max-w-md",children:"(*The likelihood of development is extrapolated from the 2015-2019 period to 8 years by multiplying by 8/5.)"})]})}function C(e){var t,n=null===(t=e.permit_address)||void 0===t?void 0:t.toLowerCase();return n=n?(0,l.Q)(n):"[no address]",(0,s.jsx)("li",{children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{children:[n,": ",e.permit_units," units (",e.permit_year,")."]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"font-bold",children:"Type:"})," ",e.permit_category]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"font-bold",children:"Match type:"})," ",e.match_type]})]})})}function A(e,t,n){if("sitesWithMatchesLayer"==t){var r=JSON.parse(n["match_results_"+e+"ft"]);return(0,s.jsxs)("div",{className:"max-h-72 overflow-y-auto",children:[(0,s.jsxs)("p",{children:["Expected capacity in housing element: ",n.site_capacity_units," units"]}),r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{children:["Matched permits (total ",r.map((function(e){return e.permit_units||0})).reduce((function(e,t){return e+t}),0)," units):"]}),(0,s.jsx)("ul",{className:"list-disc list-outside pl-5",children:r.map(C)})]}):(0,s.jsx)("p",{children:"Matched permits: None"})]})}if("permitsLayer"==t)return u=n,(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{children:[(0,l.Q)(u.permit_address.toLowerCase()),": ",u.permit_units," units (",u.permit_year,")."]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"font-bold",children:"Type:"})," ",u.permit_category]})]});if("summaryLayer"==t){for(var i=p({},n),a=0,o=Object.keys(i);a<o.length;a++){var c=o[a];c.includes("results")&&(i[c]=JSON.parse(i[c]))}return S(i,e)}throw"Unknown layer clicked: "+t;var u}},5301:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(2562)}])}},function(e){e.O(0,[774,634,926,888,179],(function(){return t=5301,e(e.s=t);var t}));var t=e.O();_N_E=t}]);